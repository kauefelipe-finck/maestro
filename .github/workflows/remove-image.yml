on:
  pull_request:
    types: closed

jobs:
    remove:
        runs-on:
            - ubuntu-latest
        steps:
          - name: Checkout
            uses: actions/checkout@v2

          - name: Configure AWS credentials
            uses: aws-actions/configure-aws-credentials@v1
            with:
              aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
              aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
              aws-region: ${{ secrets.AWS_REGION }}

          - name: Set tag-variable
            run: echo "IMAGE_TAG=$(cut -d'/' -f3 <<< $GITHUB_REF)" >> $GITHUB_ENV
             
          - name: Remove Docker image in ECR
            run: aws ecr batch-delete-image --repository-name my-repo --image-ids imageTag=${{ env.IMAGE_TAG }}
